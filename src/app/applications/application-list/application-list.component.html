<div class="application-list">

    <h1 class="sr-only">Public Review and Comment Application List</h1>

    <!-- APPLICATION LIST VIEW -->
    <div class="list-container">
        <a role="button" class="accordion__collapse-header--column toggle gtm-show-hide-filters collapsed" data-toggle="collapse" href="#collapseOptions"
            aria-expanded="false" aria-controls="collapseOptions">
            <span class="open-icon"><i class="material-icons">arrow_drop_down</i>Show Filters</span>
            <span class="close-icon"><i class="material-icons">arrow_drop_up</i>Hide Filters</span>
        </a>
        <div class="collapse list-container-options pt-0" id="collapseOptions">
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="cpStatusMenuButton" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false">Comment Period Statuses ({{cpStatusCount()}})</button>
                <div class="dropdown-menu" aria-labelledby="cpStatusMenuButton" (click)="$event.stopPropagation()">
                    <label class="dropdown-item" *ngFor="let key of cpStatusKeys">
                        <input class="gtm-filter-cp-status" type="checkbox" [checked]="cpStatusFilters[key]" (click)="cpStatusFilterClick(key)" name="{{key}}">
                        {{key}}
                    </label>
                </div>
            </div>

            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="appStatusMenuButton" data-toggle="dropdown" aria-haspopup="true"
                    aria-expanded="false">Application Statuses ({{appStatusCount()}})</button>
                <div class="dropdown-menu" aria-labelledby="appStatusMenuButton" (click)="$event.stopPropagation()">
                    <label class="dropdown-item" *ngFor="let key of appStatusKeys">
                        <input class="gtm-filter-app-status" type="checkbox" [checked]="appStatusFilters[key]" (click)="appStatusFilterClick(key)" name="{{key}}">
                        {{key}}
                    </label>
                </div>
            </div>

            <h2 class="title">Applicant</h2>
            <input type="text" [(ngModel)]="applicantFilter" (keyup)="redrawMap()">

            <h2 class="title">Crown Land File #</h2>
            <input type="number" [(ngModel)]="clFileFilter" (keyup)="redrawMap()"
                (keydown.arrowup)="$event.preventDefault()" (keydown.arrowdown)="$event.preventDefault()" (mousewheel)="$event.preventDefault()">

            <h2 class="title">Disposition ID</h2>
            <input type="number" [(ngModel)]="dispIdFilter" (keyup)="redrawMap()"
                (keydown.arrowup)="$event.preventDefault()" (keydown.arrowdown)="$event.preventDefault()" (mousewheel)="$event.preventDefault()">

            <h2 class="title">Purpose/Subpurpose</h2>
            <input type="text" [(ngModel)]="purposeFilter" (keyup)="redrawMap()">

            <div class="list-container-options__buttons mt-2">
                <!-- <button type="button" class="btn btn-primary gtm-apply-filters" (click)="applyFilters($event)">Apply</button> -->
                <a role="button" href="#" (click)="resetFilters($event)" title="Reset filters">Reset</a>
            </div>
        </div>

        <div class="list-group" *ngIf="applications">
            <div class="list-group-item" *ngIf="applications.length === 0">
                No applications found.
            </div>

            <ng-template ngFor let-item [ngForOf]="applications">
                <div *ngIf="showThisApp(item)" class="list-group-item list-group-item-action" [class.active]="isCurrentApp(item)" [hidden]="!item.isVisible" (click)="setCurrentApp(item)">
                    <h2>{{item.client || 'Unknown Client'}}</h2>
                    <span class="badge" [ngClass]="{'badge-primary'   : commentPeriodService.isNotStarted(item.currentPeriod),
                                                    'badge-secondary' : commentPeriodService.isNotOpen(item.currentPeriod),
                                                    'badge-danger'    : commentPeriodService.isClosed(item.currentPeriod),
                                                    'badge-success'   : commentPeriodService.isOpen(item.currentPeriod)}">
                        {{item.cpStatus}}
                        <div *ngIf="item.currentPeriod">
                            {{item.currentPeriod.startDate | date:'mediumDate'}} - {{item.currentPeriod.endDate | date:'mediumDate'}}
                        </div>
                    </span>
                    <ul class="nv-list">
                        <li>
                            <span class="nv-list__item--name">Status</span>
                            <span class="nv-list__item--value">{{item.appStatus}}</span>
                        </li>
                        <li class="nv-list_item">
                            <span class="nv-list__item--name">Purpose</span>
                            <span class="nv-list__item--value" *ngIf="item.purpose && item.subpurpose">
                                <span>{{item.purpose | titlecase}}</span>
                                <span>({{item.subpurpose | titlecase}})</span>
                            </span>
                            <span class="nv-list__item--value" *ngIf="!item.purpose || !item.subpurpose">-</span>
                        </li>
                        <li class="nv-list_item">
                            <span class="nv-list__item--name">Tenure Type</span>
                            <span class="nv-list__item--value" *ngIf="item.type && item.subtype">
                                <span>{{item.type | titlecase}}</span>
                                <span>({{item.subtype | titlecase}})</span>
                            </span>
                            <span class="nv-list__item--value" *ngIf="!item.type || !item.subtype">-</span>
                        </li>
                    </ul>
                    <div class="list-group-item__buttons">
                        <a (click)="$event.stopPropagation();" [routerLink]="['/a', item._id]">Go to Application Details &nbsp; &rsaquo;</a>
                    </div>
                </div>
            </ng-template>
        </div>
    </div>

    <!-- APPLICATION MAP VIEW -->
    <app-main-map #mapref class="map-container" (visibleLayer)="visibleLayer($event)"></app-main-map>
    
</div>