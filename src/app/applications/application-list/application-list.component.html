<div class="application-list">
    <div class="spinner-container" *ngIf="loading">
        <div class="spinner-new rotating"></div>
    </div>

    <h1 class="sr-only">Public Review and Comment Application List</h1>

    <!-- APPLICATION LIST VIEW -->
    <div class="list-container" *ngIf="!loading">
        <a role="button" class="accordion__collapse-header--column toggle gtm-show-hide-filters collapsed" data-toggle="collapse"
            href="#collapseOptions" aria-expanded="false" aria-controls="collapseOptions">
            <!-- [attr.aria-expanded]="getShowFilters()" [class.collapsed]="!getShowFilters()" (click)="setShowFilters(!getShowFilters())"> -->
            <span class="open-icon"><i class="material-icons">arrow_drop_down</i>Show Filters</span>
            <span class="close-icon"><i class="material-icons">arrow_drop_up</i>Hide Filters</span>
        </a>
        <div class="collapse list-container-options pt-0" id="collapseOptions">
            <!-- [class.show]="getShowFilters()"> -->
            <div class="dropdown">
                <button class="btn dropdown-toggle" [ngClass]="(cpStatusCount() > 0) ? 'btn-primary' : 'btn-light'" type="button" id="cpStatusMenuButton"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Comment Period Statuses ({{cpStatusCount()}})
                </button>
                <div class="dropdown-menu" aria-labelledby="cpStatusMenuButton" (click)="$event.stopPropagation()">
                    <label class="dropdown-item" *ngFor="let key of cpStatusKeys">
                        <input class="gtm-filter-cp-status" type="checkbox" [(ngModel)]="cpStatusFilters[key]" name="{{key}}"> {{commentPeriodService.commentStatuses[key]}}
                    </label>
                </div>
            </div>

            <div class="dropdown">
                <button class="btn dropdown-toggle" [ngClass]="(appStatusCount() > 0) ? 'btn-primary' : 'btn-light'" type="button" id="appStatusMenuButton"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Application Statuses ({{appStatusCount()}})
                </button>
                <div class="dropdown-menu" aria-labelledby="appStatusMenuButton" (click)="$event.stopPropagation()">
                    <label class="dropdown-item" *ngFor="let key of appStatusKeys">
                        <input class="gtm-filter-app-status" type="checkbox" [(ngModel)]="appStatusFilters[key]" name="{{key}}"> {{applicationService.applicationStatuses[key]}}
                    </label>
                </div>
            </div>

            <label class="title d-block" for="applicantInput">Applicant</label>
            <input type="text" id="applicantInput" [(ngModel)]="applicantFilter" [ngbTypeahead]="applicantSearch" [focusFirst]="false">

            <label class="title d-block" for="clFileInput">Crown Land File #</label>
            <input type="number" id="clFileInput" [(ngModel)]="clFileFilter" [ngbTypeahead]="clFileSearch" [focusFirst]="false" (keydown.arrowup)="$event.preventDefault()"
                (keydown.arrowdown)="$event.preventDefault()" (mousewheel)="$event.preventDefault()">

            <label class="title d-block" for="dispIdInput">Disposition ID</label>
            <input type="number" id="dispIdInput" [(ngModel)]="dispIdFilter" [ngbTypeahead]="dispIdSearch" [focusFirst]="false" (keydown.arrowup)="$event.preventDefault()"
                (keydown.arrowdown)="$event.preventDefault()" (mousewheel)="$event.preventDefault()">

            <label class="title d-block" for="purposeInput">Purpose/Subpurpose</label>
            <input type="text" id="purposeInput" [(ngModel)]="purposeFilter" [ngbTypeahead]="purposeSearch" [focusFirst]="false">

            <div class="list-container-options__buttons mt-2">
                <button type="button" class="btn btn-primary gtm-apply-filters" (click)="applyFilters($event)" title="Apply filters">Filter</button>
                <a role="button" href="#" (click)="clearFilters($event)" title="Clear filters">Clear</a>
                <a role="button" href="#" (click)="resetFilters($event)" title="Reset filters">Reset</a>
                <!-- <span>({{filteredApps && filteredApps.length}} apps)</span> -->
            </div>
        </div>

        <div class="list-group">
            <div class="d-block w-100 text-center py-3" *ngIf="!appsCount()">
                <em>No matching applications found.</em>
            </div>

            <ng-template ngFor let-item [ngForOf]="filteredApps">
                <div *ngIf="item.isVisible" class="list-group-item list-group-item-action" [class.active]="isCurrentApp(item)" (click)="setCurrentApp(item)">
                    <div class="row list-group-item__detail">
                        <div class="col-12 mt-0">
                            <label>Client</label>
                            <p class="value-large">{{item.client || 'Unknown Client'}}</p>
                        </div>
                        <div class="col-12 mt-1">
                            <label>Purpose / Subpurpose</label>
                            <p class="value" *ngIf="item.purpose && item.subpurpose">{{item.purpose | titlecase}} / {{item.subpurpose | titlecase}}</p>
                            <p class="value" *ngIf="!item.purpose || !item.subpurpose">-</p>
                        </div>
                        <div class="col-7 mt-1">
                            <label>Disposition Transaction ID</label>
                            <p class="value">{{item.tantalisID}}</p>
                        </div>
                        <div class="col-5 mt-1">
                            <label>Crown Land File #</label>
                            <p class="value">{{item.cl_file}}</p>
                        </div>
                        <div class="col-12 mt-1">
                            <label>Status</label>
                            <p class="value-large">{{item.appStatus}}</p>
                        </div>
                    </div>
                    <div class="list-group-item__buttons d-flex justify-content-between align-items-center">
                        <div class="badge" [ngClass]="{'badge-primary'   : commentPeriodService.isNotStarted(item.currentPeriod),
                                                            'badge-secondary' : commentPeriodService.isNotOpen(item.currentPeriod),
                                                            'badge-danger'    : commentPeriodService.isClosed(item.currentPeriod),
                                                            'badge-success'   : commentPeriodService.isOpen(item.currentPeriod)}">
                            {{item.cpStatus}}
                            <span class="font-weight-normal" *ngIf="commentPeriodService.isNotStarted(item.currentPeriod)">: &nbsp;&nbsp;
                                {{item.currentPeriod.startDate | date:'mediumDate'}}
                            </span>
                            <span class="font-weight-normal" *ngIf="commentPeriodService.isClosed(item.currentPeriod)">: &nbsp;&nbsp;
                                {{item.currentPeriod.endDate | date:'mediumDate'}}
                            </span>
                            <span class="font-weight-normal" *ngIf="commentPeriodService.isOpen(item.currentPeriod)">: &nbsp;&nbsp;
                                {{item.currentPeriod.startDate | date:'MMM dd'}} - {{item.currentPeriod.endDate | date:'MMM dd'}}
                            </span>
                        </div>
                        <a (click)="$event.stopPropagation();" [routerLink]="['/a', item._id]" title="Go to application details">
                            <i class="material-icons md-36">arrow_forward</i>
                        </a>
                    </div>
                </div>
            </ng-template>
        </div>
    </div>

    <!-- APPLICATION MAP VIEW -->
    <app-main-map class="map-container" (visibleLayer)="visibleLayer($event)"></app-main-map>

</div>